# 拡張性向上のための機能提案（標準モジュール活用編）

本ドキュメントでは、Clip_Watcherの拡張性をさらに高めるための機能提案を行います。
特に、Pythonの標準ライブラリのみを使用し、外部依存を増やさずに実現可能な機能に焦点を当てています。

## 1. 外部スクリプト実行機能 (Macro Support)
ユーザーが作成した任意のPythonスクリプトやバッチファイルを、クリップボードの内容に対して実行できる機能です。

*   **概要**: 特定のフォルダ（例: `user_scripts/`）に配置されたスクリプトをメニューから選択し、実行します。クリップボードの内容を標準入力として渡し、標準出力をクリップボードに書き戻します。
*   **利点**: ユーザーは本体のコードを変更することなく、複雑なテキスト処理ロジックを自由に追加できます。
*   **使用する標準モジュール**: `subprocess`
*   **実装イメージ**:
    ```python
    import subprocess
    def run_script(script_path, input_text):
        result = subprocess.run(
            ['python', script_path],
            input=input_text, text=True, capture_output=True
        )
        return result.stdout
    ```

## 2. ネットワークインターフェース (Local Network API)
ローカルネットワーク経由でクリップボードを操作できる簡易なAPIサーバー機能です。これにより、PC上の他のアプリケーションだけでなく、同一ネットワーク内の別デバイス（スマートフォンや別のPC）との連携も可能になります。

*   **概要**: 別のアプリケーションやスクリプトから、HTTPリクエストを通じてクリップボードの内容を取得・設定できるようにします。セキュリティのため、デフォルトでは無効化されており、ユーザーが明示的に有効にする必要があります。
*   **利点**: ブラウザの拡張機能、シェルスクリプト、他の言語で作られたツール、さらにはスマートフォンのショートカット機能などとの高度な連携が可能になります。
*   **主要なユースケース**:
    *   ブラウザ拡張機能からWebページのテキストをワンクリックでPCのクリップボードに送信する。
    *   スマートフォンの共有メニューから、テキストやURLをPCに転送する。
    *   バッチファイルやスクリプト処理の途中で、PCのクリップボード内容を動的に更新する。

### API仕様 (入力・設定の詳細)
シンプルで汎用性の高いRESTful APIを提供します。

*   **Endpoint**: `/clipboard`
*   **認証**: 全てのリクエストでHTTPヘッダーに `X-Api-Key: {設定したAPIキー}` を含める必要があります。

#### `GET /clipboard`
クリップボードの現在の内容を取得します。

*   **リクエスト**: なし
*   **レスポンス (Success)**: `Content-Type: application/json`
    ```json
    {
        "status": "success",
        "content": "現在のクリップボードのテキスト"
    }
    ```

#### `POST /clipboard`
クリップボードに新しい内容を設定します。

*   **リクエスト**: `Content-Type: application/json`
    ```json
    {
        "content": "クリップボードに設定したい新しいテキスト"
    }
    ```
*   **レスポンス (Success)**: `Content-Type: application/json`
    ```json
    {
        "status": "success",
        "message": "Clipboard updated."
    }
    ```

### ユーザー設定項目
ユーザーがアプリケーションの設定画面から安全に管理できる項目を提供します。

*   `network_api.enabled`: (Boolean) API機能を有効にするか。デフォルトは `false`。
*   `network_api.host`: (String) サーバーがリッスンするIPアドレス。`127.0.0.1` (ローカルホストのみ) または `0.0.0.0` (ネットワーク内の全インターフェース) を選択可能。デフォルトは `127.0.0.1`。
*   `network_api.port`: (Integer) 使用するポート番号。デフォルトは `8181`。
*   `network_api.api_key`: (String) 認証用のシークレットキー。初回有効時に自動生成することが望ましい。

### セキュリティに関する考慮事項
この機能はクリップボードという機密情報にアクセスするため、セキュリティは最優先で考慮されるべきです。

*   **デフォルトで無効**: ユーザーが意図しない限り、APIサーバーは起動しません。
*   **APIキーによる認証**: APIキーを知らない限り、第三者からの操作を防ぎます。
*   **信頼できるネットワークでの利用**: `host` を `0.0.0.0` に設定する場合、公共のWi-Fiなど信頼できないネットワークでは使用しないよう、UI上でユーザーに警告を出す必要があります。
*   **CORS設定**: ブラウザ拡張機能などWebからのアクセスを許可する場合、Cross-Origin Resource Sharing (CORS) ヘッダーを適切に設定する必要があります。

*   **使用する標準モジュール**: `http.server`, `threading`, `json`, `secrets` (APIキー生成用)
*   **実装イメージ**: `http.server.BaseHTTPRequestHandler` を継承し、リクエストヘッダーのAPIキーを検証後、`do_GET` で内容を返し、`do_POST` でリクエストボディのJSONを解析してクリップボードを更新する。

## 3. ファイルシステム連携 (File Watcher/Auto-Save)
ファイルシステム上の特定のファイルやディレクトリとクリップボードを同期させる機能です。

*   **概要**:
    1.  **自動保存**: クリップボードの履歴を特定のフォルダにテキストファイルとして自動保存します（日時ファイル名など）。
    2.  **監視取り込み**: 特定のファイルが更新されたら、その内容を自動的にクリップボードに取り込みます。
*   **利点**: ファイルベースで動作する他のエディタやツールとのシームレスな連携が可能になります。ログとしての利用も可能です。
*   **使用する標準モジュール**: `os`, `glob`, `time`

## 4. 永続化層の強化 (SQLite Integration)
現在のJSONベースの保存に加え、より堅牢なデータ管理機能を提供します。

*   **概要**: 履歴データの保存先として、SQLiteデータベースを選択できるようにします。
*   **利点**: 履歴が数万件になってもパフォーマンスを維持でき、高度な検索（全文検索や期間指定など）がSQLクエリで容易に実装可能になります。
*   **使用する標準モジュール**: `sqlite3`
*   **実装イメージ**: `HistoryManager` クラスを抽象化し、`JsonHistoryStorage` と `SqliteHistoryStorage` に分離。

## 5. コマンドラインインターフェース (CLI Automation)
GUIを起動せずに、コマンドライン引数だけでテキスト処理を行える機能です。

*   **概要**: `python clip_watcher.py --process "json_format" --input input.txt` のように、Clip_Watcherの内部ロジック（プラグイン）をCLIツールとして利用できるようにします。
*   **利点**: バッチ処理や自動化スクリプトの一部としてClip_Watcherの機能を再利用できます。
*   **使用する標準モジュール**: `argparse`, `sys`

## 6. パイプライン処理 (Processing Pipelines)
既存のプラグインを組み合わせて、一連の処理定義を作成できる機能です。

*   **概要**: 設定ファイル（JSON）で「処理の順序」を定義できるようにします。例：「HTMLエスケープ解除」→「正規表現置換」→「定型文追加」。
*   **利点**: 新しいプラグインコードを書かなくても、既存の機能の組み合わせで新しいワークフローを作成できます。
*   **使用する標準モジュール**: `json` (設定読み込み), `functools` (関数合成など)

---
これらの機能はすべてPython標準ライブラリのみで実装可能であり、プロジェクトの依存関係を複雑にすることなく、ユーザーに対して高い自由度と拡張性を提供できます。
