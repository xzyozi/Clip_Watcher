# プラグインアーキテクチャ設計案

## 1. 概要

本ドキュメントは、Clip_Watcherにプラグイン機能を導入するための設計と実装計画を定めるものです。
プラグインアーキテクチャの導入により、アプリケーションのコア機能に影響を与えることなく、テキスト処理などの追加機能を柔軟に開発・導入できる環境を構築することを目的とします。

## 2. 設計方針

- **拡張性**: 新しいプラグインを簡単に追加できるように、プラグインの発見と読み込みは動的に行われるようにします。
- **関心の分離**: プラグインのロジックは、アプリケーションのコアロジックから完全に分離します。
- **カスタマイズ性**: ユーザーはGUIを通じて、各プラグインの有効/無効を自由に切り替えられるようにします。
- **保守性**: 将来的な仕様変更や機能追加が容易になるよう、シンプルで一貫性のある設計を目指します。

## 3. 実装計画

実装は、以下の2つのフェーズに分けて進めます。

### フェーズ1: プラグインシステムの基盤構築

まず、プラグインを管理し、クリップボードのテキストを処理するためのバックエンドの仕組みを構築します。

1.  **プラグインディレクトリの作成**:
    -   `src/plugins/` ディレクトリを新設し、個別のプラグインファイルを格納します。

2.  **プラグインインターフェースの定義**:
    -   すべてのプラグインが継承するべき `Plugin` ベースクラスを `src/plugins/base_plugin.py` に定義します。
    -   インターフェースには、プラグイン名 (`name`)、説明 (`description`)、処理メソッド (`process(text)`) を含めます。

3.  **プラグイン管理クラス (`PluginManager`) の作成**:
    -   `src/plugin_manager.py` を新設します。
    -   役割:
        -   `src/plugins/` ディレクトリからプラグインを動的に発見・読み込み。
        -   設定ファイルに基づき、プラグインの有効/無効状態を管理。
        -   テキストを受け取り、有効なプラグインで順番に処理を実行する `apply_plugins` メソッドを提供。

4.  **コア機能との統合**:
    -   `ClipboardMonitor` (`src/clipboard_monitor.py`) を修正し、`PluginManager` を利用します。クリップボードのデータが履歴に追加される前に、`apply_plugins` メソッドを呼び出してテキストを加工します。
    -   `SettingsManager` (`src/settings_manager.py`) を拡張し、`settings.json` 内で各プラグインの有効状態を管理できるようにします。（例: `{"plugins": {"json_formatter": true}}`）
    -   メインのアプリケーション (`clip_watcher.py`) で `PluginManager` を初期化し、各コンポーネントに渡します。

5.  **サンプルプラグインの実装**:
    -   動作確認のため、以下の2つの簡単なプラグインを実装します。
        -   `json_formatter_plugin.py`: テキストがJSON形式であれば整形する。
        -   `case_converter_plugin.py`: テキストを大文字または小文字に変換する。

### フェーズ2: GUIとの連携

次に、ユーザーがプラグインを管理するためのUIを構築します。

1.  **設定ウィンドウの改修**:
    -   `SettingsWindow` (`src/gui/settings_window.py`) に「プラグイン」タブを追加します。
    -   `PluginManager` から利用可能なプラグインのリストを取得し、プラグイン名、説明、そして有効/無効を切り替えるためのチェックボックスを動的に生成・表示します。
    -   チェックボックスの状態は `SettingsManager` と連動させ、設定の読み込みと保存が行えるようにします。

## 4. 変更履歴

| 日付 | 変更者 | 変更内容 |
| :--- | :--- | :--- |
| | | |
