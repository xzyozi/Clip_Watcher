# アーキテクチャと拡張性に関するレビュー (2025/12/20)

## 1. 総評

現在のアーキテクチャは、関心の分離（Core, GUI, Plugins, Event Handlers）が意識されており、良好な基盤を持っています。特に、プラグイン機構とイベントディスパッチャの採用は、拡張性とコンポーネント間の疎結合を促進する上で正しいアプローチです。

しかし、さらなる拡張性の向上とメンテナンス性の改善のために、いくつかの領域でアーキテクチャを洗練させることができます。

## 2. 改善提案

### 2.1. 「GUIツール」と「プラグイン」の統合

#### 現状の問題点
`main_gui.py` を確認すると、`HashCalculatorComponent` や `UnitConverterComponent` といったGUIを持つツール（機能タブ）が、`ttk.Notebook` に対してハードコードで直接インスタンス化され、追加されています。

これにより、新しいGUIツールをアプリケーションに追加するたびに `main_gui.py` を直接編集する必要があり、以下の問題が生じます。
- **拡張性の低下:** 新機能の追加が単一のファイル変更で完結せず、修正箇所が分散します。
- **メンテナンス性の悪化:** `main_gui.py` が、自身が直接関知する必要のない個別のツールコンポーネントの実装に依存してしまい、密結合な状態になっています。

#### 提案
**GUIを持つツールを「プラグイン」の一種として統合し、動的にロードする仕組みを導入します。**

1.  **プラグインインターフェースの拡張:**
    - `BasePlugin` クラスに、GUIコンポーネントを提供するためのメソッド（例: `create_gui_component(parent)`)と、GUIを持つかを示すフラグ（例: `has_gui`) を追加します。

2.  **GUIツールのプラグイン化:**
    - `HashCalculatorComponent` などの既存のツールを、この新しいインターフェースを実装したプラグインとしてリファクタリングします。

3.  **GUIの動的構築:**
    - `main_gui.py` は `PluginManager` を通じて「GUIを持つプラグイン」の一覧を取得します。
    - 取得したプラグインの `create_gui_component` メソッドを呼び出してGUIコンポーネント（タブ）を生成し、`ttk.Notebook` に動的に追加します。

#### 期待される効果
- **拡張性の向上:** 新しいGUIツールを追加する際、`main_gui.py` を変更することなく、新しいプラグインファイルを1つ作成するだけで機能追加が完了します。
- **疎結合の促進:** `main_gui.py` は個別のツールの実装詳細を知る必要がなくなり、`PluginManager` と `BasePlugin` インターフェースのみに依存するようになります。これにより、アーキテクチャがよりクリーンになります。

### 2.2. 設定管理の一元化と拡張

#### 現状の問題点
`SettingsManager` が存在しますが、プラグインが独自の設定項目を持つ場合の管理方法が不明確です。新しいプラグインが設定を必要とする場合、`SettingsWindow` のようなGUIコードを直接変更する必要がある可能性が高いです。

#### 提案
- プラグインが自身の設定項目を定義できるインターフェース（例: `get_config_definitions()`）を `BasePlugin` に追加します。
- `SettingsManager` は、各プラグインから設定定義を収集し、一元的に管理します。
- `SettingsWindow` は、`SettingsManager` から全設定定義を取得し、動的に設定UIを生成します。

#### 期待される効果
- **拡張性の向上:** プラグインは自身の設定項目を自己完結して定義でき、設定画面のコードを修正する必要がなくなります。

---

## 3. 提案の実装計画

1.  **【ステップ1: GUIツールとプラグインの統合】**
    1.  `src/plugins/base_plugin.py` を修正し、GUIコンポーネントを返すためのインターフェースを追加する。
    2.  既存のツール（`HashCalculatorComponent`）を、新しいプラグインインターフェースを実装するプラグインとしてリファクタリングする (`src/plugins/hash_calculator_plugin.py` を作成)。
    3.  `src/core/plugin_manager.py` を修正し、GUIを持つプラグインを識別できるようにする。
    4.  `src/gui/main_gui.py` を修正し、`PluginManager` からGUIを持つプラグインを取得して動的にUIタブを組み込むようにする。
    5.  `main_gui.py` から `HashCalculatorComponent` のハードコードされた依存関係を削除し、古いコンポーネントファイル (`src/gui/components/hash_calculator_component.py`) を削除する。

2.  **【ステップ2: 設定管理の拡張】**
    *（ステップ1完了後に実施）*

3.  **【ステップ3: イベントハンドラの動的登録】**
    *（オプション、より高度なリファクタリング）*