# レビュー結果: ディレクトリ構成と拡張性について

**日付**: 2026年1月27日
**対象バージョン**: Current (FileSystem)

本レビューでは、現在のClip_Watcherプロジェクトのディレクトリ構成と、拡張性に関する設計について評価を行います。特に、保守性と将来的な機能拡張の観点から、トレードオフを含めて分析します。

## 1. ディレクトリ構成の評価

現在の `src` 配下の構成は、役割（Core, GUI, Event Handlers, Plugins）ごとに明確に分離されており、**関心の分離 (Separation of Concerns)** が良好に実現されています。

### 良い点
*   **GUIの構造化**: `src/gui` が `base`, `components`, `dialogs`, `windows` と細分化されており、UIコンポーネントの再利用性と保守性が高い構成です。特に `base` クラス（`base_toplevel_gui.py` 等）の存在は、UIの一貫性を保つのに役立っています。
*   **イベントハンドラの分離**: `src/event_handlers` を独立させている点は高く評価できます。GUIコード内にロジックが埋め込まれる「Fat GUI」問題を回避し、ロジックのテスト容易性を高めています。
*   **コアロジックの集中**: `src/core` に `clipboard_monitor` や `plugin_manager` などの主要機能が集約されており、アプリケーションの心臓部がどこにあるか明確です。

### 懸念点とトレードオフ
*   **プラグインディレクトリのフラット構造**:
    *   **現状**: `src/plugins` にすべてのプラグインファイルがフラットに置かれています。
    *   **課題**: 標準搭載プラグインが増えた場合、ファイル一覧の視認性が低下します。また、機能種別（テキスト処理系、GUIツール系、システム連携系など）が混在しています。
    *   **トレードオフ (単純さ vs 整理)**: 現状はファイル追加だけでプラグイン追加できる単純さがありますが、将来的に分類（サブディレクトリ化）が必要になる可能性があります。ただし、サブディレクトリ化すると動的読み込みロジックが若干複雑になります。
*   **設定ファイルと永続化データの場所**:
    *   **現状**: `settings.json` などがルートにあるように見えます（実行環境依存かもしれませんが）。
    *   **課題**: ソースコード管理下のディレクトリにユーザーデータが混在すると、アップデート時や配布時に支障が出ます。
    *   **推奨**: ユーザーデータはOS標準の場所（`AppData` や `~/.config`）または、ポータブルモード用の独立した `user_data` ディレクトリに分離すべきです。

## 2. 拡張性の評価

プラグインアーキテクチャとイベント駆動モデルが採用されており、基本的な拡張性は確保されています。

### 良い点
*   **Plugin Managerの存在**: `src/core/plugin_manager.py` と `src/plugins/base_plugin.py` により、機能追加のインターフェースが定義されています。これにより、本体コードを変更せずに機能追加が可能です。
*   **イベント駆動**: `event_dispatcher.py` を介した通信により、新しいコンポーネント（例えば新しい通知システムやログ出力）を追加する際に、既存コードへの影響を最小限に抑えられます。

### 提案されている拡張案（標準ライブラリ活用）との適合性
前回の提案（外部スクリプト、ネットワークI/F等）を実装する場合の観点です。

*   **外部スクリプト連携**:
    *   現状の `src/plugins` はPythonクラスベースのプラグインを想定していると思われます。ユーザーが任意の `.py` や `.bat` を配置して実行させる場合、セキュリティと管理の観点から、`src/plugins` とは別の `scripts` ディレクトリ（ユーザー書き込み可能領域）を設けるのが適切です。
    *   **トレードオフ (統合 vs 分離)**: 既存のプラグインシステムに無理やり統合するより、「ScriptRunnerPlugin」のような1つのプラグインが、外部ディレクトリのスクリプトを読み込んでメニュー化するアプローチが、アーキテクチャを壊さずに済みます。

*   **SQLiteなどの永続化層の変更**:
    *   `src/core/fixed_phrases_manager.py` や `history_handlers.py` などが、現在のJSON保存形式に強く依存している可能性があります。
    *   **改善案**: データアクセス層（DAOパターンやRepositoryパターン）を導入し、`JSONStorage` と `SQLiteStorage` を切り替えられるインターフェース（抽象基底クラス）を `src/core/storage/` などに用意すると、拡張性が飛躍的に向上します。

## 3. 総合的な推奨事項

1.  **ディレクトリの階層化**:
    *   `src/plugins` 内を `standard`（標準搭載）と `user`（ユーザー追加）に論理的または物理的に分けることを検討してください。
    *   `src/core/storage` または `src/core/data` パッケージを作成し、データの保存・読み込みロジックを各マネージャから分離・抽象化することを推奨します。

2.  **ユーザーデータの分離**:
    *   アプリケーションのインストール先（読み取り専用になりうる）と、設定・履歴・ユーザースクリプトの保存先（書き込み可能）を明確に分離するディレクトリ設計を確立してください。

この構成であれば、機能が増大しても保守性を維持しつつ、ユーザーによるカスタマイズ（拡張性）を安全に提供できます。
